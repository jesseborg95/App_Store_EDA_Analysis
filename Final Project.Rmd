---
title: "Description of Data"
author: "Jonathan Giguere"
date: "10/2/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(include = TRUE)
```

```{r basicfcn, include=F}
# can add quietly=T option to the require() function
loadPkg = function(x) { if (!require(x,character.only=T, quietly =T)) { install.packages(x,dep=T,repos="http://cran.us.r-project.org"); if(!require(x,character.only=T)) stop("Package not found") } }
```

```{r, packages, include = F}
library(magrittr)
library(corrplot)
library(ggplot2)
library(dplyr)
library(viridis)
library(viridisLite)
```

## Section 1: Introduction

The popularity of smartphones has increased greatly every year since Apple released the Iphone in 2007, with approximately 10 billion [Statista](https://statista.com) smartphones sold worldwide since then. Of these 10 billion, Iphones account for almost 20% of sales with a total revenue of $165 billion in 2018 alone [CEO World Magazine](https://ceoworld.biz). Since the meteoric rise of the smartphone and tech industries, many app developers have taken the opportunity to develop their own apps for different operating systems and made them available to download on the appleStore and/or the Google playstore. Today, there are over 2.2 billion iOS apps [Lifewire](https://lifewire.com) and 2.7 billion apps on the Google playstore [Statista](https://statista.com). On average, people spend on around 3 hours on their phone each day [Hacker Noon](https://hackernoon.com); with the majority of time being spent on different apps. Due to the huge popularity of apps, there is a wide variety of genres available for every type of audience with a wide range of pricing. Since many people invest so much time and effort into apps, app data has become an interesting and relevant topic to conduct more research on. 

This report focuses mainly on a sample of apps from the appleStore, where the composition of this sample will be analysed in depth. The report itself will contain 6 additional chapters: Chapter 2 looks at the source data and the general composition of the dataset. Chapter 3 compares the apps in the appleStore to that in the Google playstore; chapter 4 looks at the different app categories; chapter 5 analyses the pricing of the apps and looks at the relationship between app pricing and popularity. Finally chapter 6 is the report conclusion where we report our findings based on the analysis.

## Section 2: Description of Data

### 2.1 Source Data

The source data for our EDA comes from two datasets that our team discovered on [Kaggle](https://www.kaggle.com).  The first dataset contains information about apps in the Google Play Store.  The second contains information about apps in the Apple App Store.  First, we will describe the data pertaining to the Google Play Store.

#### Google Play Data Structure

The Google Play Store dataset contains records for 10,840 different apps.  The variables, and their descriptions are given below:

* **App** - The name of the application
* **Category** - The category that the app belongs in
* **Rating** - The current app rating on a scale from 1 to 5 (1 being the lowest)
* **Reviews** - The number of reviews for the app
* **Size** - Size of the app given in MB
* **Installs** - Number of installs given as categories (ex. 10,000+)
* **Type** - Tells which apps are free and which require payment
* **Price** - Gives the Price for each app
* **Content_Rating** - Indicates which age groups the app is approved for
* **Genres** - A further breakdown of the Category variable for each app
* **Last Updated** - Date the app was last updated
* **Current_Ver** - Current_Version of the app

```{r import Google Play Data, echo=F}
library("stringr")
# setwd("/Users/jonathangiguere/Desktop/DATS 6101/Projects/Project 1/Data-Science-Project-Final-master")
googlePlay <- read.csv('googleplaystore.csv')
googlePlay <- subset(googlePlay, select = -c(Android.Ver) )
googlePlay$Size <- str_remove(googlePlay$Size, 'M')
str(googlePlay)
```

### 2.2 Clean the Data

Check how many null values are in the playstore data frame:
```{r check NA, echo = F, include = T}

# review how many fields are NA
plotNA <- barplot(sapply(googlePlay,function(x)sum(is.na(x))),
                  col = "lightblue",
                  main = "Playstore NA Values",
                  ylab = "Count of Null Values",
                  xlab = "App Categories")
```


```{r clean NA, echo = F, include = T}
# create new data frame for apps where NA is null, then remove rating NAs from main playstore dataset
ratingNA <- subset(googlePlay, is.na(Rating))
googlePlay = na.omit(googlePlay)

# to double check that the NAs have been removed
sapply(googlePlay,function(x)sum(is.na(x)))
nrow(googlePlay)
```


The only field with null values is Rating with 1474 missing values. We will store these values in a separate data frame in case we would like to do future analysis on this data. Then we will remove them from the main playstore dataset.


Now we will check whether there are duplicates. We will do this by checking the difference between all and unique object.
```{r check dups, echo = F, include = T}

distinct <- nrow(googlePlay %>%
  distinct())

duplicates <- nrow(googlePlay) - distinct
duplicates
```
There are `r duplicates` duplicates in the data. The next step is to remove duplicates from playstore.
```{r remove dups, echo = F, include = T}

googlePlay=googlePlay[!duplicated(googlePlay), ]


# to double check that the duplicates have been removed
distinct <- nrow(googlePlay %>%
  distinct())

nrow(googlePlay) - distinct

```


#### Apple Store Data Structure

The Apple App Store dataset contains records for 7,197 different apps.  The variables, and their descriptions are given below:

* **App** - The name of the application
* **Category** - The category that the app belongs in
* **Rating** - The current app rating on a scale from 1 to 5 (1 being the lowest)
* **Reviews** - The number of reviews for the app
* **Size** - Size of the app given in MB
* **Price** - Gives the Price for each app
* **Content_Rating** - Indicates which age groups the app is approved for
* **Current_Ver** - Current_Version of the app

```{r import Apple Store Data, echo=F}
appleStore <- read.csv('applestore.csv')
appleStore <- subset(appleStore, select = -c(id, currency, rating_count_ver,
                                             user_rating_ver, sup_devices.num,
                                             ipadSc_urls.num, lang.num,
                                             vpp_lic))
colnames(appleStore) <- c('X', 'App', 'Size', 'Price', 'Reviews',
                          'Rating', 'Current_Ver', 'Content_Rating',
                          'Category')
appleStore$Size <- round(appleStore$Size/1000000, 0)
str(appleStore)
```

## Section 3: App Store Vs. Google Playstore

Even though the App Store is going to be analyzed in this report, a comparative analysis will be made before between the App Store and Google Playstore. This will serve as a guide to the structure of each platform and provide a visual comparison between the two.

The appleStore dataset contains 7197 different apps whereas the Google Playstore contains 10840.

```{r merge}

```

### 3.1 Rating Composition

```{r box1}
df1 <- data.frame(appleStore$Price)
df2 <- data.frame(googlePlay$Price)
ggplot(appleStore, aes(y = Price)) +
  geom_boxplot()
```

### 3.2 Rating Distribution of Apps

```{r hist}
hist(googlePlay$Rating, main = 'Histogram of frequency rating for the Google Playstore', xlab = 'Rating', col = viridis(20))
hist(appleStore$Rating, main = 'Histogram of frequency rating for the Apple Store', xlab = 'Rating', col = viridis(12))
```

### 3.3 Price Composition

```{r box2}
```

### 3.4 Free Vs. Paid

```{r pie}
#appleStore$Type <- factor(ifelse(appleStore$Price == 0.00, 0, 1), labels = c('Free', 'Paid'))

#ggplot(appleStore, aes(x = " ", y=Type, fill = Type)) +
  #geom_bar(stat = "identity") +
  #ggtitle('Price Composition of Apps in the Appstore') +
  #coord_polar("y", start=0) +
  #theme_void()

#ggplot(googlePlay, aes(x = " ", y=Type, fill = Type)) +
  #geom_bar(stat = "identity") +
  #ggtitle('Price Composition of Apps in the Google Playstore') +
  #coord_polar("y", start=0) +
  #theme_void()
```


# Price

KEY QUESTION: How does the price influence the distribution of apps across category, rating and content rating
``` {r type, echo = F}
# Create two new dataframes for free and paid apps separately
freeApps <- subset(googlePlay, googlePlay$Price == 0.00)
paidApps <- subset(googlePlay, googlePlay$Price != 0.00)

nrow(freeApps)
nrow(paidApps)
```

There are `r nrow(freeApps)` free apps and `r nrow(paidApps)` paid apps corresponding to `r format((nrow(freeApps)/nrow(googlePlay))*100, digits=3)`% and `r format((nrow(paidApps)/nrow(googlePlay))*100, digits=3)`% respectively in Google playstore 


How do users rate free and paid apps across different categories
```{r echo=F}
# Create new dataframe and new column, assign categorical values of 0 and 1 for free and paid apps respectively   
  googlePlay_cat <- googlePlay[which(googlePlay$Price == 0.00 |googlePlay$Price != 0.00), ]
  googlePlay_cat$PriceCat <- factor(ifelse(googlePlay_cat$Price == 0.00, 0, 1), labels = c("Free", "Paid"))
  
  ggplot(googlePlay_cat, aes(x = Category, y = Rating)) +
    geom_boxplot(fill=viridis(61)) +
    #ggtitle("Boxplot of User Rating by Genre across Free Vs Paid Apps")
    theme_bw() +
    theme(plot.title = element_text(hjust = 0.5)) +
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + 
    theme(axis.text.x = element_text(angle = 90, hjust = 1, size = 6, color = 'black')) +
    facet_grid(. ~ PriceCat)
```
What kind of ratings does the different content rating categories have for both free and paid apps
```{r echo=F}
  ggplot(googlePlay_cat, aes(x = Content.Rating, y = Rating)) +
      geom_boxplot(fill=viridis(10)) +
      ggtitle("Boxplot of User Rating by Content Rating across Free Vs Paid Apps")+
      facet_grid(. ~ PriceCat) +
      theme_bw() +
      theme(plot.title = element_text(hjust = 0.5)) +
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
      theme(axis.text.x = element_text(angle = 90, hjust = 1, size = 6, color = 'black'))      
```

How are free apps distributed by category
```{r echo = F}
# create a dataframe sorted by count of category for free apps and plot
 freeAppsCount <- freeApps %>% group_by(Category) %>% summarise(NumOfApps = n()) %>% arrange(desc(NumOfApps)) %>% mutate(Category = factor(Category, levels = unique(Category)))

 ggplot(freeAppsCount, aes(x=Category, y=NumOfApps)) +
  geom_bar( fill = viridis(33), color = 'black', stat = 'identity') +
  ggtitle('Free Apps in the Google Playstore by Category') + 
  xlab('Category') + ylab('Number of Apps') + 
  #coord_cartesian(ylim = c(0, 1800)) + 
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1, size = 8, color = 'black')) +
  coord_flip()

```

Top 5 Category for Free Apps

```{r echo=F}
  head(freeAppsCount, n = 5)
```
```{r echo = F}
# create a dataframe sorted by count of category for paid apps and plot

  paidAppsCount <- paidApps %>% group_by(Category) %>% summarise(NumOfApps = n()) %>% arrange(desc(NumOfApps)) %>% mutate(Category = factor(Category, levels = unique(Category)))

ggplot(paidAppsCount, aes(x = Category, y = NumOfApps)) +
  geom_bar(fill = viridis(28), color = 'black', stat = 'identity') +
  ggtitle('Paid Apps in Google Playstore by Category') + 
  xlab('Category') + ylab('Number of Apps') + 
  coord_cartesian(ylim = c(0, 200)) + 
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1, size = 8, color = 'black')) +
  coord_flip()
```

Top 5 Category for Paid Apps
```{r echo=F}
  head(paidAppsCount, n = 5)
```
In the Playstore, apps are either free or paid. 
What category of apps are rated more in the free vs paid apps?

```{r echo = F}
# create new dataframe containing different categories and their respective average rating for free apps
catFreeRating = freeApps %>% group_by(Category) %>% summarise( Avg_rating = mean(Rating)) %>% 
arrange(desc(Avg_rating)) %>% mutate(Category = factor(Category, levels = unique(Category)))

ggplot(catFreeRating, aes(x = Category, y = Avg_rating)) + 
  geom_bar(stat = 'Identity', fill = viridis(33), color = "black") +
  ggtitle("Average Rating of Free Apps by Category") +
   ylab('Average Rating') +
  coord_cartesian(ylim = c(1.5, 5.5)) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5)) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, size = 9, color = 'black')) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank())
```


```{r echo = F}
# create new dataframe containing different categories and their respective average rating for paid apps
catPaidRating = paidApps %>% group_by(Category) %>% summarise( Avg_rating = mean(Rating)) %>% 
arrange(desc(Avg_rating)) %>% mutate(Category = factor(Category, levels = unique(Category)))

ggplot(catPaidRating, aes(x = Category, y = Avg_rating)) + 
  geom_bar(stat = 'Identity', fill = viridis(28), color = "black") +
  ggtitle("Average Rating of Paid Apps by Category") +
   ylab('Average Rating') +
  coord_cartesian(ylim = c(1.5, 5.5)) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5)) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, size = 9, color = 'black')) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank())

```

Do users rate free apps better than paid apps?
Top 5 rated category in Free Apps 
```{r echo=F}
# top rated categories for free apps 
  head(catFreeRating, n = 5)
```

Top 5 rated category in Paid Apps 
```{r echo=F}
# top rated caetegories for paid apps
  head(catPaidRating, n = 5)
```

How is the content rating distributed between free and paid apps?
```{r echo = F}
ggplot(freeApps, aes(Content.Rating)) +
  geom_bar(fill = viridis(6), color = 'black') +
  ggtitle('Free Apps in Google Playstore by Content Rating') + 
  xlab('Content Rating') + ylab('Number of Apps') + 
  coord_cartesian(ylim = c(0, 10000)) + 
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1, size = 8, color = 'black'))
```

```{r echo = F}
ggplot(paidApps, aes(Content.Rating)) +
  geom_bar(fill = viridis(4), color = 'black') +
  ggtitle('Paid Apps in Google Playstore by Content Rating') + 
  xlab('Content Rating') + ylab('Number of Apps') + 
  coord_cartesian(ylim = c(0, 1000)) + 
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + 
  theme(axis.text.x = element_text(angle = 0, hjust = 1, size = 8, color = 'black'))
```




```{r echo=F}
# strip the dollar sign off the price and convert to numeric data type
  paidApps$Price <- as.numeric(str_remove(paidApps$Price, '\\$'))

# Create new column and a split price into different categories
  paidApps$PriceCategory <- cut(paidApps$Price, breaks = c(0, 10, 100, 401), labels = c("Cheap", "Expensive", "Very Expensive"), right=FALSE)
```


How are the apps distributed across different price categories
```{r echo=F}
# Plot bar chart showing the number of apps for different price categories
  ggplot(paidApps, aes(PriceCategory)) +
  geom_bar(fill = viridis(3), color = 'black') +
  ggtitle('Free Apps in Google Playstore by Price Category') + 
  xlab('Price Category') + ylab('Number of Apps') + 
  coord_cartesian(ylim = c(0, 700)) + 
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5)) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + 
  theme(axis.text.x = element_text(angle = 0, hjust = 1, size = 8, color = 'black'))
```
What are the average ratings across different price categories
```{r echo=F}
# create a data frame, group by price category, calulate and sort by average rating
  priceCatRating = paidApps %>% group_by(PriceCategory) %>% summarise( Avg_rating = mean(Rating)) %>% arrange(Avg_rating)

# Plot bar chart showing the average rating for different price categories
ggplot(priceCatRating, aes(x = PriceCategory, y = Avg_rating)) + 
  geom_bar(stat = 'Identity', fill = viridis(3), color = "black") +
  ggtitle("Average Rating of Paid Apps by Price Category") +
   ylab('Average Rating') +
   xlab('Price Category') +
  coord_cartesian(ylim = c(1.5, 5.5)) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5)) +
  theme(axis.text.x = element_text(angle = 0, hjust = 1, size = 9, color = 'black')) +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank())
```

Are the average ratings the same across different price categories
```{r echo=F}
# Create dataframe and store Price Category and User Rating columns and perform anova
    priceCatRating <- subset(paidApps, select = c("PriceCategory", "Rating"))
    anovaRatingPrice <- aov(Rating ~ PriceCategory,  data=priceCatRating)
    summary(anovaRatingPrice)
    anovaRatPrice <- summary(anovaRatingPrice)
    anovaRatPrice[[1]][[5]][[1]]
```

```{r echo = F}
# Create a boxplot of user rating by different price categories
ggplot(priceCatRating, aes(x = PriceCategory, y = Rating)) +
      geom_boxplot(fill=viridis(3)) +
      ggtitle("Boxplot of User Rating by Price Category")+
      ylab("User Rating") +
      xlab("Price Category") +
      theme_bw() +
      theme(plot.title = element_text(hjust = 0.5)) +
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
      theme(axis.text.x = element_text(angle = 0, hjust = 0.5, size = 10, color = 'black'))
```

Are the average installed apps the same across different price categories
```{r echo=F}
# clean installs column and cast to numeric
    paidApps$Installs <- str_remove(paidApps$Installs, '\\+')
    paidApps$Installs <- as.numeric(gsub(',','',paidApps$Installs))

# Create dataframe and store Price Category and Installs columns and perform anova
    priceCatInstalls <- subset(paidApps, select = c("PriceCategory", "Installs"))
    anovaInstallsPrice <- aov(Installs ~ PriceCategory,  data=priceCatInstalls)
    summary(anovaInstallsPrice)
    anovaInstPrice <- summary(anovaInstallsPrice)
    anovaInstPrice[[1]][[5]][[1]]
```

```{r echo=F}
# Create a boxplot of apps installed by different price categories
ggplot(priceCatInstalls, aes(x = PriceCategory, y = Installs)) +
      geom_boxplot(fill=viridis(3)) +
      ggtitle("Boxplot of Apps Installed by Price Category")+
      ylab("Apps Installed") +
      xlab("Price Category") +
      theme_bw() +
      theme(plot.title = element_text(hjust = 0.5)) +
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
      theme(axis.text.x = element_text(angle = 0, hjust = 0.5, size = 10, color = 'black'))
```


```{r echo = F}
  lcpaidApps <- subset(paidApps, select = c("Rating", "Installs", "Price"))
  str(lcpaidApps)
```

Get Correlation Matrix
```{r echo=F}
# Get correlation matrix for all numerical variables
  paidAppsCor = cor(lcpaidApps)
  corrplot(paidAppsCor, method = 'number')

```

Carry out fitting with linear models
```{r echo=F}
# fit the price to the rating
  lm1 = lm(Rating ~ Price, data = lcpaidApps)
  summary(lm1)
  vif(lm1)
```

```{r echo=F}
# fit the number of app installs to the rating
  lm2 = lm(Rating ~ Installs, data = lcpaidApps)
  summary(lm2)
  vif(lm2)
```

```{r echo=F}
# fit the price and number of app installs to the rating
  lm3 = lm(Rating ~ Price+Installs, data = lcpaidApps)
  summary(lm3)
  vif(lm3)
```